<%- include('layout', { body: '<div>\nContent here\n</div>' }) %>
<div class="card">
  <div class="card-header d-flex justify-content-between align-items-center">
    <h5 class="mb-0">Groups</h5>
    <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#createGroupModal">Create Group</button>
  </div>
  <div class="card-body">
    <% if (groups && groups.length > 0) { %>
      <div class="list-group">
        <% groups.forEach(group => { %>
          <a href="/groups/<%= group._id %>" class="list-group-item list-group-item-action d-flex justify-content-between align-items-center">
            <div>
              <strong><%= group.name %></strong>
              <div class="small text-muted"><%= group.description %></div>
            </div>
            <span class="badge bg-secondary"><%= group.members.length %></span>
          </a>
        <% }); %>
      </div>
    <% } else { %>
      <p class="text-muted">You are not a member of any groups yet.</p>
    <% } %>
  </div>
</div>

<!-- Create Group Modal -->
<div class="modal fade" id="createGroupModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <form action="/groups/create" method="POST" id="createGroupForm">
        <div class="modal-header">
          <h5 class="modal-title">Create Group</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <div class="mb-3">
            <label for="groupName" class="form-label">Group Name</label>
            <input type="text" name="name" id="groupName" class="form-control" required>
          </div>
          <div class="mb-3">
            <label for="groupDescription" class="form-label">Description</label>
            <textarea name="description" id="groupDescription" class="form-control"></textarea>
          </div>
          <div class="mb-3">
            <label for="groupMembers" class="form-label">Add Members (comma separated user IDs)</label>
            <input type="text" name="members" id="groupMembers" class="form-control" placeholder="userId1,userId2">
            <div class="form-text">You can paste user IDs separated by commas. Creator will always be added.</div>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
          <button type="submit" class="btn btn-primary">Create</button>
        </div>
      </form>
    </div>
  </div>
</div>

<script>
document.getElementById('createGroupForm').addEventListener('submit', function(e) {
  // Convert comma-separated members into multiple form fields if present
  const membersInput = document.getElementById('groupMembers');
  if (membersInput && membersInput.value.trim()) {
    const raw = membersInput.value.split(',').map(s => s.trim()).filter(Boolean);
    // Remove the single text field and create hidden inputs for each
    // Note: form submission will include multiple 'members' fields which Express parses as array
    raw.forEach(id => {
      const input = document.createElement('input');
      input.type = 'hidden';
      input.name = 'members';
      input.value = id;
      this.appendChild(input);
    });
    // Clear the visible input so it doesn't send the comma string
    membersInput.disabled = true;
  }
});
</script>
